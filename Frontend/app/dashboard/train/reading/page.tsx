'use client';
import React, { useEffect, useState, useRef } from 'react';
import { ArrowsPointingInIcon, HeartIcon } from '@heroicons/react/24/outline';
import Stopwatch from '@/app/components/stop-watch';
import Link from "next/link";
import { Button } from '@headlessui/react';
import { AppRoutes } from '@/app/routes';
import Loader from '@/app/components/ui/loader';

export default function Page() {
  const [currentState, setCurrentState] = useState<string | null>('Relaxing');
  const [relaxedDataRecorded, setRelaxedDataRecorded] = useState(false);
  const [focusedDataRecorded, setFocusedDataRecorded] = useState(false);
  const [trainingDone, setTrainingDone] = useState(false);
  const [isLoaded, setIsLoaded] = useState(false);
  const [modelIsTraining, setModelIsTraining] = useState(false);

  const trainingDoneRef = useRef(trainingDone);
  trainingDoneRef.current = trainingDone;

  async function checkModelState() {
    const response0 = await fetch("http://localhost:8000/model-training/check-model-status", {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      credentials: 'include',
    })
    const data0 = await response0.json();
    if (data0.status === "success") {
      await setTrainingDone(true);
    }
  }

  async function checkDataState() {
    await checkModelState()
    const response = await fetch('http://localhost:8000/model-training/check-data-status', {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ state: "Relaxing" }),
      credentials: 'include',

    });
    const data = await response.json();
    if (data.status == "success") {
      setRelaxedDataRecorded(true);
    }

    const response2 = await fetch('http://localhost:8000/model-training/check-data-status', {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ state: "Focused" }),
      credentials: 'include',
    });
    const data2 = await response2.json();
    if (data2.status == "success") {
      setFocusedDataRecorded(true);
    }

    setIsLoaded(true);

  }

  const handleStateChange = async (state: string) => {
    if (state === 'Relaxing' && !relaxedDataRecorded) {
      await setCurrentState(state);
    } else if (state === 'Focused' && !focusedDataRecorded) {
      await setCurrentState(state);
    }
  }

  async function handleStartTraining() {
    await fetch('http://localhost:8000/model-training/train-model', {
      method: "POST",
      headers: {
        'Content-Type': 'application/json',
      },
      credentials: 'include',
    });

    console.log("Training Started");
    setModelIsTraining(true);

    const intervalId = setInterval(async () => {
      await checkModelState();
      if (trainingDoneRef.current) {
        clearInterval(intervalId);
        setModelIsTraining(false);
      }
    }, 2000);
  }

  useEffect(() => {
    checkDataState();

  }, []);

  const currentStates = [
    {
      icon: <HeartIcon className='size-6 text-primary' />,
      label: 'Relaxing',
      description: 'Ease your mind and engage in a calm, low-intensity learning experience.',
    },
    {
      icon: <ArrowsPointingInIcon className='size-6 text-primary' />,
      label: 'Focused',
      description: 'Sharpen your attention for a high-intensity, immersive training session.',
    }
  ]

  if (!isLoaded) {
    return (<>
      <Loader />
    </>)
  }

  return (
    <div className='max-w-4xl mx-auto'>
      <div className='mt-5'>
        <div className='flex flex-col items-center justify-center bg-neutral-100 border rounded-xl lg:rounded-3xl p-3 lg:p-5' >
          <svg className='size-60' viewBox="0 0 41 38" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20.5467 7.32213C20.3029 5.27442 17.5378 4.7033 16.8971 4.41773C16.5279 4.25057 16.1866 4.16003 15.9011 4.16003C15.6782 4.16003 15.3508 4.20182 15.0026 4.57096C14.5081 5.09333 14.2225 6.00575 14.2782 6.8903L10.7122 8.49921C10.7052 8.49921 10.6982 8.49224 10.6843 8.49224C10.4893 8.43652 10.2873 8.40866 10.0853 8.40866C9.06842 8.40866 8.16994 9.0982 7.90527 10.0733C7.81473 10.4146 7.8008 10.7628 7.87741 11.118L5.21679 14.0294C4.96605 14.2244 4.76407 14.4682 4.61084 14.7538C4.33224 15.2901 4.27652 15.903 4.45064 16.4811C4.52726 16.7388 4.65263 16.9756 4.81282 17.1845L4.86158 17.2472C5.59986 18.2014 5.3352 19.5874 4.29741 20.2073C3.72629 20.5486 3.28749 21.0988 3.16212 21.7466C3.09621 22.0747 3.10389 22.4134 3.1846 22.7382C3.26531 23.063 3.41704 23.3659 3.62887 23.625C3.8407 23.8841 4.10736 24.0931 4.40964 24.2368C4.71191 24.3804 5.0423 24.4553 5.37699 24.456C5.47449 24.456 5.56504 24.442 5.66255 24.4351L7.55702 27.7992C7.18788 28.2728 7.02768 28.8509 7.09733 29.4638C7.20181 30.3762 7.89831 31.1632 8.78982 31.3861C9.44453 31.5463 10.0992 31.414 10.6355 31.0448L13.916 32.7025C13.9648 34.4925 15.1837 34.7572 15.9011 34.7572C16.7856 34.7572 18.3109 34.2557 18.4433 32.3751L20.5467 32.2985V7.32213Z" className='fill-secondary animate-pulse' />
            <path d="M40.9053 20.6879C40.5919 19.8939 39.8884 19.8939 39.5611 19.9984C39.3869 20.0541 39.1501 20.2004 38.9969 20.4441C38.8576 20.667 38.7879 20.9665 38.8924 21.3566C38.9133 21.4262 38.9412 21.5028 38.983 21.5725C39.178 21.9416 39.4427 22.1157 39.7004 22.1784C39.931 22.2315 40.1726 22.2096 40.3899 22.1157C40.7033 21.9695 41.2118 21.4889 40.9053 20.6879ZM40.0347 23.2928C40.5501 23.5645 40.7451 24.1983 40.4735 24.7067C40.108 25.4051 39.5924 26.014 38.9638 26.4896C38.3353 26.9653 37.6092 27.2959 36.8377 27.4579C36.991 27.9176 37.0955 28.3981 37.1233 28.8927C37.1303 28.9902 37.1303 29.0877 37.1303 29.1922C37.1303 29.7633 36.6636 30.2369 36.0855 30.2369C35.8696 30.2369 35.6676 30.1672 35.5005 30.0558C35.2219 29.8678 35.0408 29.5474 35.0408 29.1922V29.0111C35.006 28.4539 34.8318 27.9245 34.5393 27.4509C32.9095 27.0887 31.4956 25.9952 30.7852 24.4281C30.7284 24.3037 30.6967 24.1694 30.6919 24.0327C30.6871 23.8961 30.7092 23.7598 30.7571 23.6318C30.805 23.5037 30.8776 23.3863 30.9709 23.2863C31.0641 23.1863 31.1762 23.1057 31.3006 23.049C31.8299 22.8053 32.4498 23.0421 32.6866 23.5645C32.9502 24.1419 33.3736 24.6318 33.9068 24.9762C34.44 25.3205 35.0607 25.505 35.6955 25.5077C36.9283 25.5077 38.0497 24.8251 38.6277 23.7316C38.7568 23.4875 38.9772 23.3044 39.2407 23.2221C39.5043 23.1399 39.7897 23.1653 40.0347 23.2928ZM36.392 10.7698C39.0317 11.7797 40.4804 14.6771 39.6307 17.4144C39.4357 18.0203 39.1432 18.5915 38.7531 19.0999C38.5511 19.3646 38.2377 19.5039 37.9243 19.5039C37.7014 19.5039 37.4785 19.4342 37.2905 19.288C36.8308 18.9397 36.7472 18.285 37.0955 17.8253C37.3392 17.5119 37.5203 17.1636 37.6318 16.7945C38.1193 15.2204 37.3671 13.5627 35.9323 12.8523C35.8557 13.0195 35.7721 13.1866 35.6816 13.3468C34.9711 14.6005 33.808 15.492 32.415 15.8751C32.1481 15.9466 31.8638 15.9098 31.6239 15.7729C31.3839 15.636 31.2077 15.4099 31.1334 15.1438C30.9802 14.5866 31.3145 14.0085 31.8648 13.8553C32.2851 13.7438 32.679 13.5496 33.0234 13.2841C33.3678 13.0186 33.6558 12.6871 33.8707 12.309C34.0862 11.9318 34.2252 11.5157 34.2799 11.0847C34.3345 10.6537 34.3037 10.2161 34.1893 9.79701C34.0748 9.37789 33.8788 8.98542 33.6127 8.64204C33.3465 8.29866 33.0152 8.01109 32.6379 7.79575C32.2617 7.57954 31.8465 7.43991 31.4162 7.38492C30.9859 7.32994 30.5489 7.36067 30.1305 7.47536C30.0887 7.48929 30.0539 7.51018 30.019 7.51715C29.9285 8.06738 29.7683 8.59672 29.5315 9.0982C29.1066 9.98971 28.4728 10.6862 27.6858 11.1668C26.8918 11.6404 25.9515 11.8981 24.8998 11.8981C24.3217 11.8981 23.855 11.4315 23.855 10.8534C23.855 10.2822 24.3217 9.80862 24.8998 9.80862C26.5296 9.80862 27.2957 8.93104 27.644 8.19971C28.2499 6.92512 28.0619 5.16995 27.2122 4.11824C26.5296 3.27548 25.5406 2.98991 24.3217 3.27548C22.7406 3.65159 21.8979 4.80081 21.5984 7.11318C21.7029 8.02559 21.7098 8.90318 21.7168 9.6345C21.7307 11.4036 21.7098 13.1727 21.682 14.9348C21.7238 15.0184 21.7725 15.102 21.8422 15.1717C22.1974 15.5199 22.866 15.701 23.4023 15.7846C23.8899 15.0184 24.8789 13.8971 26.5435 13.7299C26.8197 13.7022 27.0955 13.7853 27.3104 13.961C27.5253 14.1367 27.6615 14.3905 27.6893 14.6667C27.717 14.9429 27.6338 15.2187 27.4582 15.4336C27.2825 15.6484 27.0286 15.7847 26.7525 15.8124C25.5197 15.9308 24.9764 17.2403 24.9764 17.2542C24.8162 17.6512 24.4331 17.9159 24.0083 17.9159H23.9874C23.7715 17.9159 22.6989 17.895 21.6541 17.4701C21.6332 18.8631 21.6053 20.2491 21.5984 21.6421C21.5914 21.858 21.5914 22.0809 21.5914 22.2968C21.5914 22.868 21.1248 23.3346 20.5467 23.3346C19.9686 23.3346 19.5019 22.861 19.5019 22.2829C19.5019 22.0879 19.5089 21.8929 19.5089 21.6909C19.5089 21.663 19.5019 21.6352 19.5019 21.6073C19.5019 20.2213 19.481 18.8422 19.4601 17.4631C18.4084 17.895 17.3219 17.9159 17.106 17.9159H17.0851C16.6602 17.9159 16.2771 17.6512 16.117 17.2542C16.103 17.2054 15.5667 15.9308 14.3409 15.8124C14.2041 15.7987 14.0714 15.7582 13.9504 15.6932C13.8293 15.6282 13.7222 15.54 13.6352 15.4336C13.5482 15.3272 13.483 15.2047 13.4434 15.0731C13.4037 14.9415 13.3904 14.8034 13.4041 14.6667C13.4178 14.53 13.4583 14.3973 13.5233 14.2762C13.5883 14.1551 13.6766 14.048 13.7829 13.961C13.9978 13.7853 14.2737 13.7022 14.5498 13.7299C16.2145 13.8971 17.2035 15.0184 17.691 15.7776C17.9348 15.7428 18.2343 15.6871 18.5199 15.5826C19.091 15.3876 19.3208 15.1438 19.4253 14.9279C19.3905 12.9847 19.3696 11.0066 19.3905 9.04944C19.3975 8.52707 19.4044 7.83057 19.488 7.05746C19.2721 5.43462 18.7219 4.09038 17.3289 3.46353C16.117 2.9133 15.107 3.01081 14.3339 3.75606C13.2892 4.76598 12.9131 6.74403 13.5051 8.17185C13.8115 8.92407 14.515 9.80862 16.1309 9.80862H16.1936C16.4706 9.80678 16.7371 9.91508 16.9344 10.1097C17.1316 10.3043 17.2434 10.5693 17.2453 10.8464C17.2471 11.1235 17.1388 11.39 16.9442 11.5872C16.7496 11.7844 16.4846 11.8963 16.2075 11.8981H16.1309C13.9996 11.8981 12.335 10.8325 11.5688 8.96586C11.3877 8.5201 11.2763 8.04648 11.2136 7.5659C11.13 7.53804 11.0464 7.50322 10.9629 7.47536C10.1131 7.24551 9.22163 7.35695 8.45548 7.79575C8.07812 8.01109 7.74689 8.29866 7.4807 8.64204C7.2145 8.98542 7.01857 9.37789 6.90409 9.79701C6.78961 10.2161 6.75882 10.6537 6.81348 11.0847C6.86815 11.5157 7.00719 11.9318 7.22268 12.309C7.66147 13.0752 8.3719 13.6254 9.22859 13.8553C9.77882 14.0085 10.1131 14.5866 9.95991 15.1438C9.88566 15.4099 9.70942 15.636 9.46947 15.7729C9.22952 15.9098 8.94523 15.9466 8.67836 15.8751C7.28536 15.492 6.12221 14.6005 5.41179 13.3468C5.32124 13.1866 5.23766 13.0195 5.16105 12.8523C3.72626 13.5558 2.96708 15.2204 3.46159 16.7875C3.57303 17.1636 3.75412 17.5119 3.9979 17.8253C4.0869 17.9424 4.15028 18.077 4.1839 18.2202C4.21752 18.3634 4.22064 18.5121 4.19306 18.6566C4.16547 18.8011 4.10779 18.9382 4.02377 19.059C3.93975 19.1798 3.83127 19.2815 3.70537 19.3576C3.21157 19.6492 2.80264 20.0649 2.51918 20.5634C2.23572 21.0619 2.08758 21.6259 2.08949 22.1993C2.08949 22.7774 1.62284 23.2441 1.04475 23.2441C0.466653 23.2441 0 22.7774 0 22.1993C0 20.667 0.661673 19.2113 1.77607 18.1945C1.65015 17.9412 1.54532 17.6779 1.46264 17.4074C0.612918 14.6771 2.06163 11.7727 4.70136 10.7698C4.68743 10.2613 4.75011 9.7529 4.88941 9.25143C5.26552 7.85843 6.164 6.70224 7.4177 5.98485C8.57854 5.31589 9.949 5.10945 11.2554 5.40676C11.4922 4.19485 12.0494 3.05956 12.8852 2.25162C14.2712 0.91435 16.2075 0.656645 18.1925 1.55513C19.2651 2.04268 20.0104 2.774 20.5258 3.61676C21.1805 2.53022 22.2113 1.63174 23.8411 1.2417C25.8331 0.768085 27.6509 1.33921 28.835 2.80186C29.427 3.53318 29.8031 4.43166 29.9773 5.37193C31.2449 5.12816 32.5404 5.33711 33.6757 5.98485C34.2928 6.33429 34.8342 6.80309 35.2682 7.36392C35.7023 7.92475 36.0204 8.56639 36.2039 9.25143C36.3432 9.7529 36.4059 10.2683 36.392 10.7698ZM39.5332 6.51419C39.6934 7.30123 39.1571 7.7261 38.7601 7.81664C38.6835 7.83754 38.6138 7.8445 38.5442 7.8445C38.0636 7.8445 37.6109 7.47536 37.4925 6.99477C37.4855 6.96691 37.4785 6.93209 37.4716 6.89726C37.3462 6.11022 37.9034 5.71322 38.3074 5.6366C38.8646 5.53213 39.4148 5.96396 39.5332 6.51419ZM38.4397 3.61676C38.5405 3.77409 38.5971 3.95567 38.6035 4.14242C38.6099 4.32917 38.5659 4.5142 38.4761 4.67808C38.3864 4.84196 38.2541 4.97864 38.0933 5.07377C37.9324 5.1689 37.749 5.21896 37.5621 5.2187C37.2139 5.2187 36.8795 5.05154 36.6776 4.73812C35.1453 2.3352 32.0319 2.09143 31.9971 2.09143C31.721 2.0718 31.464 1.94342 31.2825 1.73449C31.101 1.52556 31.0098 1.25314 31.029 0.977034C31.0638 0.405906 31.5444 -0.0328871 32.1294 0.00193779C32.3036 0.0158677 36.3293 0.301432 38.4397 3.61676ZM35.8627 30.9195C36.3293 31.2607 36.4268 31.9155 36.0855 32.3821C35.9044 32.6328 35.7025 32.8627 35.4796 33.0786C35.2776 33.2736 35.0129 33.3642 34.7552 33.3642C34.5801 33.3654 34.4076 33.322 34.254 33.2379C34.1004 33.1537 33.9709 33.0318 33.8776 32.8836C33.613 32.4727 33.6617 31.9224 34.0309 31.5672C34.1632 31.4418 34.2955 31.2956 34.407 31.1423C34.4877 31.0319 34.5895 30.9385 34.7065 30.8675C34.8234 30.7965 34.9533 30.7493 35.0885 30.7285C35.2238 30.7078 35.3618 30.714 35.4946 30.7468C35.6275 30.7796 35.7525 30.8382 35.8627 30.9195Z" className='fill-primary animate-pulse' />
            <path d="M32.6031 32.9602C32.7145 33.1204 32.7842 33.3224 32.7842 33.5383C32.7842 34.1164 32.3105 34.583 31.7394 34.583C31.1474 34.583 30.5832 34.4855 30.0539 34.3114C29.3574 36.7004 27.247 37.8496 25.2898 37.8914H25.1714C23.465 37.8914 21.6541 37.0904 20.5467 35.5512C19.4323 37.0904 17.6214 37.8914 15.915 37.8914H15.8035C13.8464 37.8496 11.736 36.7004 11.0395 34.3114C10.5102 34.4855 9.946 34.583 9.35398 34.583C8.49843 34.5826 7.65525 34.3788 6.89403 33.9883C6.1328 33.5978 5.47536 33.0318 4.97596 32.3372C4.47656 31.6425 4.14953 30.839 4.02186 29.9931C3.89419 29.1471 3.96954 28.2829 4.24169 27.4718C3.08491 27.2163 2.04312 26.5903 1.27461 25.6888C0.905463 25.243 0.961183 24.5883 1.39998 24.2122C1.44873 24.1704 1.49749 24.1356 1.55321 24.1007C1.98503 23.857 2.54223 23.9406 2.86959 24.3376C3.18167 24.7034 3.56921 24.9974 4.00563 25.1994C4.44204 25.4014 4.91699 25.5065 5.39787 25.5077C6.68639 25.5077 7.87044 24.7415 8.40674 23.5644C8.64355 23.0421 9.26343 22.8053 9.79277 23.049C10.0783 23.1814 10.2803 23.4251 10.3569 23.7037C10.4266 23.9406 10.4127 24.1913 10.3082 24.4281C9.95942 25.1884 9.43874 25.8572 8.78724 26.3818C8.13573 26.9064 7.37123 27.2724 6.55406 27.4509C6.2267 27.9733 6.05258 28.5653 6.05258 29.1921C6.05442 30.0672 6.40284 30.9058 7.02157 31.5246C7.6403 32.1433 8.47896 32.4917 9.35398 32.4935C11.1788 32.4935 12.6623 31.01 12.6623 29.1921C12.6623 28.6141 13.129 28.1474 13.7071 28.1474C14.2852 28.1474 14.7518 28.6141 14.7518 29.1921C14.7518 30.7871 14.0484 32.2219 12.9479 33.2109C13.2056 35.0567 14.5707 35.774 15.8453 35.8019H15.9219C17.5866 35.8019 19.3278 34.6736 19.495 32.4796C19.3975 30.9891 19.4323 29.4707 19.4671 28.0081C19.488 27.2628 19.5019 26.5246 19.5019 25.7932V25.5773C19.5019 24.9992 19.9686 24.5326 20.5467 24.5326C21.1248 24.5326 21.5914 24.9992 21.5914 25.5773C21.5914 26.3295 21.6123 27.0887 21.6263 27.8549C21.6611 29.3732 21.6959 30.9473 21.5914 32.4935C21.7656 34.6736 23.4998 35.8019 25.1645 35.8019H25.2411C26.5226 35.774 27.8878 35.0567 28.1455 33.2109C27.5792 32.7055 27.1259 32.0863 26.815 31.3939C26.5042 30.7014 26.3429 29.9512 26.3416 29.1921C26.3416 28.6141 26.8082 28.1474 27.3863 28.1474C27.9644 28.1474 28.431 28.6141 28.431 29.1921C28.431 31.01 29.9146 32.4935 31.7394 32.4935C32.0946 32.4935 32.415 32.6816 32.6031 32.9602ZM27.8947 22.3804C28.0488 22.3887 28.1992 22.4307 28.3352 22.5034C28.4712 22.5762 28.5896 22.678 28.682 22.8016C28.7743 22.9252 28.8384 23.0675 28.8697 23.2186C28.9009 23.3697 28.8986 23.5258 28.8629 23.6759C28.8056 23.9024 28.6746 24.1034 28.4905 24.2471C28.3064 24.3909 28.0796 24.4693 27.846 24.4699H27.8042C27.4768 24.456 24.5933 24.2679 23.5625 22.1088C23.5023 21.9854 23.4671 21.8514 23.459 21.7143C23.451 21.5773 23.4702 21.44 23.5155 21.3105C23.5609 21.1809 23.6315 21.0617 23.7232 20.9596C23.815 20.8575 23.9261 20.7746 24.0501 20.7158C24.5724 20.465 25.1923 20.6809 25.4431 21.2033C25.8679 22.0879 27.3584 22.3525 27.8947 22.3804Z" className='fill-primary' />
            <path d="M17.6354 21.656C17.6354 21.8093 17.6005 21.9625 17.5309 22.1088C16.5001 24.2679 13.6166 24.456 13.2892 24.4699H13.2474C12.9778 24.4687 12.719 24.364 12.5246 24.1773C12.3301 23.9906 12.2148 23.7362 12.2027 23.4669C12.1748 22.8958 12.6206 22.4083 13.1987 22.3804C13.735 22.3525 15.2255 22.0879 15.6503 21.2033C15.9011 20.6809 16.521 20.465 17.0433 20.7158C17.4195 20.8969 17.6354 21.266 17.6354 21.656ZM5.71133 35.4885C6.2546 35.6905 6.53319 36.2964 6.32424 36.8327C6.17102 37.2576 5.77401 37.5153 5.34915 37.5153C5.22378 37.5153 5.10537 37.4944 4.98697 37.4526C1.76915 36.2477 0.571175 32.9881 0.52242 32.8488C0.327401 32.3055 0.612965 31.7135 1.15623 31.5184C1.6995 31.3234 2.29152 31.602 2.48654 32.1453C2.49351 32.1662 3.41985 34.6388 5.71133 35.4885Z" fill="#2C5254" />
          </svg>
          {(!relaxedDataRecorded || !focusedDataRecorded) && (<div>
            <div className='max-w-3xl mx-auto mt-10 flex flex-col items-center gap-2' >
              {currentStates.map((currentStateType) => (
                <div key={currentStateType.label} onClick={() => handleStateChange(currentStateType.label)} className={`${currentStateType.label === currentState ? 'border border-primary' : 'opacity-75'} cursor-pointer bg-white rounded-xl p-1`} >
                  <div className={`flex items-center gap-4 bg-white p-5 rounded-lg ${currentStateType.label === currentState ? 'border' : ''}`} >
                    <div className='bg-secondary/20 size-14 rounded-full flex items-center justify-center' >
                      {currentStateType.icon}
                    </div>
                    <div>
                      <div className='font-semibold' >{currentStateType.label}</div>
                      <p className='text-sm mt-1 text-gray-600' >{currentStateType.description}</p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
            <div className='mt-6' >
              <Stopwatch currentState={currentState} />
            </div>
          </div>)}

          {(!trainingDone && !modelIsTraining && relaxedDataRecorded && focusedDataRecorded) && (<div>
            <div className='max-w-3xl mx-auto mt-10 flex flex-col items-center gap-2' >
              <h3 className='text-xl font-semibold' >You have already collected the data</h3>
              <Button onClick={handleStartTraining} className='mt-6 !bg-primary text-gray-50 p-3 rounded-md' >
                Start Model Training
              </Button>
            </div>
          </div>)}
          {(!trainingDone && modelIsTraining) && (<div>
            <div className='max-w-3xl mx-auto mt-10 flex flex-col items-center gap-2' >
              <h3 className='text-xl font-semibold' >The model is training! Please Wait</h3>
              <div className='flex justify-center animate-pulse'>
                <svg width="41" height="38" viewBox="0 0 41 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20.5467 7.32213C20.3029 5.27442 17.5378 4.7033 16.8971 4.41773C16.5279 4.25057 16.1866 4.16003 15.9011 4.16003C15.6782 4.16003 15.3508 4.20182 15.0026 4.57096C14.5081 5.09333 14.2225 6.00575 14.2782 6.8903L10.7122 8.49921C10.7052 8.49921 10.6982 8.49224 10.6843 8.49224C10.4893 8.43652 10.2873 8.40866 10.0853 8.40866C9.06842 8.40866 8.16994 9.0982 7.90527 10.0733C7.81473 10.4146 7.8008 10.7628 7.87741 11.118L5.21679 14.0294C4.96605 14.2244 4.76407 14.4682 4.61084 14.7538C4.33224 15.2901 4.27652 15.903 4.45064 16.4811C4.52726 16.7388 4.65263 16.9756 4.81282 17.1845L4.86158 17.2472C5.59986 18.2014 5.3352 19.5874 4.29741 20.2073C3.72629 20.5486 3.28749 21.0988 3.16212 21.7466C3.09621 22.0747 3.10389 22.4134 3.1846 22.7382C3.26531 23.063 3.41704 23.3659 3.62887 23.625C3.8407 23.8841 4.10736 24.0931 4.40964 24.2368C4.71191 24.3804 5.0423 24.4553 5.37699 24.456C5.47449 24.456 5.56504 24.442 5.66255 24.4351L7.55702 27.7992C7.18788 28.2728 7.02768 28.8509 7.09733 29.4638C7.20181 30.3762 7.89831 31.1632 8.78982 31.3861C9.44453 31.5463 10.0992 31.414 10.6355 31.0448L13.916 32.7025C13.9648 34.4925 15.1837 34.7572 15.9011 34.7572C16.7856 34.7572 18.3109 34.2557 18.4433 32.3751L20.5467 32.2985V7.32213Z" fill="#1FDDE7" />
                  <path d="M40.9053 20.6879C40.5919 19.8939 39.8884 19.8939 39.5611 19.9984C39.3869 20.0541 39.1501 20.2004 38.9969 20.4441C38.8576 20.667 38.7879 20.9665 38.8924 21.3566C38.9133 21.4262 38.9412 21.5028 38.983 21.5725C39.178 21.9416 39.4427 22.1157 39.7004 22.1784C39.931 22.2315 40.1726 22.2096 40.3899 22.1157C40.7033 21.9695 41.2118 21.4889 40.9053 20.6879ZM40.0347 23.2928C40.5501 23.5645 40.7451 24.1983 40.4735 24.7067C40.108 25.4051 39.5924 26.014 38.9638 26.4896C38.3353 26.9653 37.6092 27.2959 36.8377 27.4579C36.991 27.9176 37.0955 28.3981 37.1233 28.8927C37.1303 28.9902 37.1303 29.0877 37.1303 29.1922C37.1303 29.7633 36.6636 30.2369 36.0855 30.2369C35.8696 30.2369 35.6676 30.1672 35.5005 30.0558C35.2219 29.8678 35.0408 29.5474 35.0408 29.1922V29.0111C35.006 28.4539 34.8318 27.9245 34.5393 27.4509C32.9095 27.0887 31.4956 25.9952 30.7852 24.4281C30.7284 24.3037 30.6967 24.1694 30.6919 24.0327C30.6871 23.8961 30.7092 23.7598 30.7571 23.6318C30.805 23.5037 30.8776 23.3863 30.9709 23.2863C31.0641 23.1863 31.1762 23.1057 31.3006 23.049C31.8299 22.8053 32.4498 23.0421 32.6866 23.5645C32.9502 24.1419 33.3736 24.6318 33.9068 24.9762C34.44 25.3205 35.0607 25.505 35.6955 25.5077C36.9283 25.5077 38.0497 24.8251 38.6277 23.7316C38.7568 23.4875 38.9772 23.3044 39.2407 23.2221C39.5043 23.1399 39.7897 23.1653 40.0347 23.2928ZM36.392 10.7698C39.0317 11.7797 40.4804 14.6771 39.6307 17.4144C39.4357 18.0203 39.1432 18.5915 38.7531 19.0999C38.5511 19.3646 38.2377 19.5039 37.9243 19.5039C37.7014 19.5039 37.4785 19.4342 37.2905 19.288C36.8308 18.9397 36.7472 18.285 37.0955 17.8253C37.3392 17.5119 37.5203 17.1636 37.6318 16.7945C38.1193 15.2204 37.3671 13.5627 35.9323 12.8523C35.8557 13.0195 35.7721 13.1866 35.6816 13.3468C34.9711 14.6005 33.808 15.492 32.415 15.8751C32.1481 15.9466 31.8638 15.9098 31.6239 15.7729C31.3839 15.636 31.2077 15.4099 31.1334 15.1438C30.9802 14.5866 31.3145 14.0085 31.8648 13.8553C32.2851 13.7438 32.679 13.5496 33.0234 13.2841C33.3678 13.0186 33.6558 12.6871 33.8707 12.309C34.0862 11.9318 34.2252 11.5157 34.2799 11.0847C34.3345 10.6537 34.3037 10.2161 34.1893 9.79701C34.0748 9.37789 33.8788 8.98542 33.6127 8.64204C33.3465 8.29866 33.0152 8.01109 32.6379 7.79575C32.2617 7.57954 31.8465 7.43991 31.4162 7.38492C30.9859 7.32994 30.5489 7.36067 30.1305 7.47536C30.0887 7.48929 30.0539 7.51018 30.019 7.51715C29.9285 8.06738 29.7683 8.59672 29.5315 9.0982C29.1066 9.98971 28.4728 10.6862 27.6858 11.1668C26.8918 11.6404 25.9515 11.8981 24.8998 11.8981C24.3217 11.8981 23.855 11.4315 23.855 10.8534C23.855 10.2822 24.3217 9.80862 24.8998 9.80862C26.5296 9.80862 27.2957 8.93104 27.644 8.19971C28.2499 6.92512 28.0619 5.16995 27.2122 4.11824C26.5296 3.27548 25.5406 2.98991 24.3217 3.27548C22.7406 3.65159 21.8979 4.80081 21.5984 7.11318C21.7029 8.02559 21.7098 8.90318 21.7168 9.6345C21.7307 11.4036 21.7098 13.1727 21.682 14.9348C21.7238 15.0184 21.7725 15.102 21.8422 15.1717C22.1974 15.5199 22.866 15.701 23.4023 15.7846C23.8899 15.0184 24.8789 13.8971 26.5435 13.7299C26.8197 13.7022 27.0955 13.7853 27.3104 13.961C27.5253 14.1367 27.6615 14.3905 27.6893 14.6667C27.717 14.9429 27.6338 15.2187 27.4582 15.4336C27.2825 15.6484 27.0286 15.7847 26.7525 15.8124C25.5197 15.9308 24.9764 17.2403 24.9764 17.2542C24.8162 17.6512 24.4331 17.9159 24.0083 17.9159H23.9874C23.7715 17.9159 22.6989 17.895 21.6541 17.4701C21.6332 18.8631 21.6053 20.2491 21.5984 21.6421C21.5914 21.858 21.5914 22.0809 21.5914 22.2968C21.5914 22.868 21.1248 23.3346 20.5467 23.3346C19.9686 23.3346 19.5019 22.861 19.5019 22.2829C19.5019 22.0879 19.5089 21.8929 19.5089 21.6909C19.5089 21.663 19.5019 21.6352 19.5019 21.6073C19.5019 20.2213 19.481 18.8422 19.4601 17.4631C18.4084 17.895 17.3219 17.9159 17.106 17.9159H17.0851C16.6602 17.9159 16.2771 17.6512 16.117 17.2542C16.103 17.2054 15.5667 15.9308 14.3409 15.8124C14.2041 15.7987 14.0714 15.7582 13.9504 15.6932C13.8293 15.6282 13.7222 15.54 13.6352 15.4336C13.5482 15.3272 13.483 15.2047 13.4434 15.0731C13.4037 14.9415 13.3904 14.8034 13.4041 14.6667C13.4178 14.53 13.4583 14.3973 13.5233 14.2762C13.5883 14.1551 13.6766 14.048 13.7829 13.961C13.9978 13.7853 14.2737 13.7022 14.5498 13.7299C16.2145 13.8971 17.2035 15.0184 17.691 15.7776C17.9348 15.7428 18.2343 15.6871 18.5199 15.5826C19.091 15.3876 19.3208 15.1438 19.4253 14.9279C19.3905 12.9847 19.3696 11.0066 19.3905 9.04944C19.3975 8.52707 19.4044 7.83057 19.488 7.05746C19.2721 5.43462 18.7219 4.09038 17.3289 3.46353C16.117 2.9133 15.107 3.01081 14.3339 3.75606C13.2892 4.76598 12.9131 6.74403 13.5051 8.17185C13.8115 8.92407 14.515 9.80862 16.1309 9.80862H16.1936C16.4706 9.80678 16.7371 9.91508 16.9344 10.1097C17.1316 10.3043 17.2434 10.5693 17.2453 10.8464C17.2471 11.1235 17.1388 11.39 16.9442 11.5872C16.7496 11.7844 16.4846 11.8963 16.2075 11.8981H16.1309C13.9996 11.8981 12.335 10.8325 11.5688 8.96586C11.3877 8.5201 11.2763 8.04648 11.2136 7.5659C11.13 7.53804 11.0464 7.50322 10.9629 7.47536C10.1131 7.24551 9.22163 7.35695 8.45548 7.79575C8.07812 8.01109 7.74689 8.29866 7.4807 8.64204C7.2145 8.98542 7.01857 9.37789 6.90409 9.79701C6.78961 10.2161 6.75882 10.6537 6.81348 11.0847C6.86815 11.5157 7.00719 11.9318 7.22268 12.309C7.66147 13.0752 8.3719 13.6254 9.22859 13.8553C9.77882 14.0085 10.1131 14.5866 9.95991 15.1438C9.88566 15.4099 9.70942 15.636 9.46947 15.7729C9.22952 15.9098 8.94523 15.9466 8.67836 15.8751C7.28536 15.492 6.12221 14.6005 5.41179 13.3468C5.32124 13.1866 5.23766 13.0195 5.16105 12.8523C3.72626 13.5558 2.96708 15.2204 3.46159 16.7875C3.57303 17.1636 3.75412 17.5119 3.9979 17.8253C4.0869 17.9424 4.15028 18.077 4.1839 18.2202C4.21752 18.3634 4.22064 18.5121 4.19306 18.6566C4.16547 18.8011 4.10779 18.9382 4.02377 19.059C3.93975 19.1798 3.83127 19.2815 3.70537 19.3576C3.21157 19.6492 2.80264 20.0649 2.51918 20.5634C2.23572 21.0619 2.08758 21.6259 2.08949 22.1993C2.08949 22.7774 1.62284 23.2441 1.04475 23.2441C0.466653 23.2441 0 22.7774 0 22.1993C0 20.667 0.661673 19.2113 1.77607 18.1945C1.65015 17.9412 1.54532 17.6779 1.46264 17.4074C0.612918 14.6771 2.06163 11.7727 4.70136 10.7698C4.68743 10.2613 4.75011 9.7529 4.88941 9.25143C5.26552 7.85843 6.164 6.70224 7.4177 5.98485C8.57854 5.31589 9.949 5.10945 11.2554 5.40676C11.4922 4.19485 12.0494 3.05956 12.8852 2.25162C14.2712 0.91435 16.2075 0.656645 18.1925 1.55513C19.2651 2.04268 20.0104 2.774 20.5258 3.61676C21.1805 2.53022 22.2113 1.63174 23.8411 1.2417C25.8331 0.768085 27.6509 1.33921 28.835 2.80186C29.427 3.53318 29.8031 4.43166 29.9773 5.37193C31.2449 5.12816 32.5404 5.33711 33.6757 5.98485C34.2928 6.33429 34.8342 6.80309 35.2682 7.36392C35.7023 7.92475 36.0204 8.56639 36.2039 9.25143C36.3432 9.7529 36.4059 10.2683 36.392 10.7698ZM39.5332 6.51419C39.6934 7.30123 39.1571 7.7261 38.7601 7.81664C38.6835 7.83754 38.6138 7.8445 38.5442 7.8445C38.0636 7.8445 37.6109 7.47536 37.4925 6.99477C37.4855 6.96691 37.4785 6.93209 37.4716 6.89726C37.3462 6.11022 37.9034 5.71322 38.3074 5.6366C38.8646 5.53213 39.4148 5.96396 39.5332 6.51419ZM38.4397 3.61676C38.5405 3.77409 38.5971 3.95567 38.6035 4.14242C38.6099 4.32917 38.5659 4.5142 38.4761 4.67808C38.3864 4.84196 38.2541 4.97864 38.0933 5.07377C37.9324 5.1689 37.749 5.21896 37.5621 5.2187C37.2139 5.2187 36.8795 5.05154 36.6776 4.73812C35.1453 2.3352 32.0319 2.09143 31.9971 2.09143C31.721 2.0718 31.464 1.94342 31.2825 1.73449C31.101 1.52556 31.0098 1.25314 31.029 0.977034C31.0638 0.405906 31.5444 -0.0328871 32.1294 0.00193779C32.3036 0.0158677 36.3293 0.301432 38.4397 3.61676ZM35.8627 30.9195C36.3293 31.2607 36.4268 31.9155 36.0855 32.3821C35.9044 32.6328 35.7025 32.8627 35.4796 33.0786C35.2776 33.2736 35.0129 33.3642 34.7552 33.3642C34.5801 33.3654 34.4076 33.322 34.254 33.2379C34.1004 33.1537 33.9709 33.0318 33.8776 32.8836C33.613 32.4727 33.6617 31.9224 34.0309 31.5672C34.1632 31.4418 34.2955 31.2956 34.407 31.1423C34.4877 31.0319 34.5895 30.9385 34.7065 30.8675C34.8234 30.7965 34.9533 30.7493 35.0885 30.7285C35.2238 30.7078 35.3618 30.714 35.4946 30.7468C35.6275 30.7796 35.7525 30.8382 35.8627 30.9195Z" fill="#2C5254" />
                  <path d="M32.6031 32.9602C32.7145 33.1204 32.7842 33.3224 32.7842 33.5383C32.7842 34.1164 32.3105 34.583 31.7394 34.583C31.1474 34.583 30.5832 34.4855 30.0539 34.3114C29.3574 36.7004 27.247 37.8496 25.2898 37.8914H25.1714C23.465 37.8914 21.6541 37.0904 20.5467 35.5512C19.4323 37.0904 17.6214 37.8914 15.915 37.8914H15.8035C13.8464 37.8496 11.736 36.7004 11.0395 34.3114C10.5102 34.4855 9.946 34.583 9.35398 34.583C8.49843 34.5826 7.65525 34.3788 6.89403 33.9883C6.1328 33.5978 5.47536 33.0318 4.97596 32.3372C4.47656 31.6425 4.14953 30.839 4.02186 29.9931C3.89419 29.1471 3.96954 28.2829 4.24169 27.4718C3.08491 27.2163 2.04312 26.5903 1.27461 25.6888C0.905463 25.243 0.961183 24.5883 1.39998 24.2122C1.44873 24.1704 1.49749 24.1356 1.55321 24.1007C1.98503 23.857 2.54223 23.9406 2.86959 24.3376C3.18167 24.7034 3.56921 24.9974 4.00563 25.1994C4.44204 25.4014 4.91699 25.5065 5.39787 25.5077C6.68639 25.5077 7.87044 24.7415 8.40674 23.5644C8.64355 23.0421 9.26343 22.8053 9.79277 23.049C10.0783 23.1814 10.2803 23.4251 10.3569 23.7037C10.4266 23.9406 10.4127 24.1913 10.3082 24.4281C9.95942 25.1884 9.43874 25.8572 8.78724 26.3818C8.13573 26.9064 7.37123 27.2724 6.55406 27.4509C6.2267 27.9733 6.05258 28.5653 6.05258 29.1921C6.05442 30.0672 6.40284 30.9058 7.02157 31.5246C7.6403 32.1433 8.47896 32.4917 9.35398 32.4935C11.1788 32.4935 12.6623 31.01 12.6623 29.1921C12.6623 28.6141 13.129 28.1474 13.7071 28.1474C14.2852 28.1474 14.7518 28.6141 14.7518 29.1921C14.7518 30.7871 14.0484 32.2219 12.9479 33.2109C13.2056 35.0567 14.5707 35.774 15.8453 35.8019H15.9219C17.5866 35.8019 19.3278 34.6736 19.495 32.4796C19.3975 30.9891 19.4323 29.4707 19.4671 28.0081C19.488 27.2628 19.5019 26.5246 19.5019 25.7932V25.5773C19.5019 24.9992 19.9686 24.5326 20.5467 24.5326C21.1248 24.5326 21.5914 24.9992 21.5914 25.5773C21.5914 26.3295 21.6123 27.0887 21.6263 27.8549C21.6611 29.3732 21.6959 30.9473 21.5914 32.4935C21.7656 34.6736 23.4998 35.8019 25.1645 35.8019H25.2411C26.5226 35.774 27.8878 35.0567 28.1455 33.2109C27.5792 32.7055 27.1259 32.0863 26.815 31.3939C26.5042 30.7014 26.3429 29.9512 26.3416 29.1921C26.3416 28.6141 26.8082 28.1474 27.3863 28.1474C27.9644 28.1474 28.431 28.6141 28.431 29.1921C28.431 31.01 29.9146 32.4935 31.7394 32.4935C32.0946 32.4935 32.415 32.6816 32.6031 32.9602ZM27.8947 22.3804C28.0488 22.3887 28.1992 22.4307 28.3352 22.5034C28.4712 22.5762 28.5896 22.678 28.682 22.8016C28.7743 22.9252 28.8384 23.0675 28.8697 23.2186C28.9009 23.3697 28.8986 23.5258 28.8629 23.6759C28.8056 23.9024 28.6746 24.1034 28.4905 24.2471C28.3064 24.3909 28.0796 24.4693 27.846 24.4699H27.8042C27.4768 24.456 24.5933 24.2679 23.5625 22.1088C23.5023 21.9854 23.4671 21.8514 23.459 21.7143C23.451 21.5773 23.4702 21.44 23.5155 21.3105C23.5609 21.1809 23.6315 21.0617 23.7232 20.9596C23.815 20.8575 23.9261 20.7746 24.0501 20.7158C24.5724 20.465 25.1923 20.6809 25.4431 21.2033C25.8679 22.0879 27.3584 22.3525 27.8947 22.3804Z" fill="#2C5254" />
                  <path d="M17.6354 21.656C17.6354 21.8093 17.6005 21.9625 17.5309 22.1088C16.5001 24.2679 13.6166 24.456 13.2892 24.4699H13.2474C12.9778 24.4687 12.719 24.364 12.5246 24.1773C12.3301 23.9906 12.2148 23.7362 12.2027 23.4669C12.1748 22.8958 12.6206 22.4083 13.1987 22.3804C13.735 22.3525 15.2255 22.0879 15.6503 21.2033C15.9011 20.6809 16.521 20.465 17.0433 20.7158C17.4195 20.8969 17.6354 21.266 17.6354 21.656ZM5.71133 35.4885C6.2546 35.6905 6.53319 36.2964 6.32424 36.8327C6.17102 37.2576 5.77401 37.5153 5.34915 37.5153C5.22378 37.5153 5.10537 37.4944 4.98697 37.4526C1.76915 36.2477 0.571175 32.9881 0.52242 32.8488C0.327401 32.3055 0.612965 31.7135 1.15623 31.5184C1.6995 31.3234 2.29152 31.602 2.48654 32.1453C2.49351 32.1662 3.41985 34.6388 5.71133 35.4885Z" fill="#2C5254" />
                </svg>
              </div>
            </div>
          </div>)}
          {(trainingDone) && (<div>
            <div className='max-w-3xl mx-auto mt-10 flex flex-col items-center gap-2' >
              <h3 className='text-xl font-semibold' >The model is trained</h3>
              <Link href={AppRoutes.DASHBOARD} >
                <Button onClick={handleStartTraining} className='mt-6 !bg-primary text-gray-50 p-3 rounded-md' >
                  Go to Dashboard
                </Button>
              </Link>
            </div>
          </div>)}
        </div>
      </div>
    </div>

  )
}